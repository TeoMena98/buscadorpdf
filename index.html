<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Buscador de Cotizaciones</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

  <style>
    body {
      background: #0d1117;
      color: #ffffff;
    }

    .card {
      border-radius: 12px;
    }

    .card:hover {
      transform: scale(1.02);
      transition: .2s ease-in-out;
    }
  </style>
</head>

<body>
  <div class="container py-5">
    <h1 class="text-center mb-4">
      <i class="bi bi-file-earmark-search"></i> Buscar Cotizaciones
    </h1>

    <!-- FORMULARIO -->
    <div class="card bg-secondary p-4 shadow-lg">
      <div class="row g-3">


        <div class="col-md-3">
          <label class="form-label">Origen</label>
          <select class="form-select" id="origen">
            <option value="BOG">Bogotá (BOG)</option>
            <option value="CLO">Cali (CLO)</option>
            <option value="MDE" selected>Medellín (MDE)</option>
            <option value="CTG">Cartagena (CTG)</option>
            <option value="BAQ">Barranquilla (BAQ)</option>
            <option value="BGA">Bucaramanga (BGA)</option>
            <option value="LET">Leticia (LET)</option>
            <option value="AXM">Armenia (AXM)</option>
            <option value="PEI">Pereira (PEI)</option>
            <option value="PSO">Pasto (PSO)</option>
            <option value="PPN">Popayán (PPN)</option>
            <option value="SMR">Santa Marta (SMR)</option>
            <option value="MTR">Montería (MTR)</option>
            <option value="RCH">Riohacha (RCH)</option>
            <option value="MVP">Mitú (MVP)</option>
            <option value="IBE">Ibagué (IBE)</option>
            <option value="NVA">Neiva (NVA)</option>
            <option value="CUC">Cúcuta (CUC)</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Destino</label>
          <input type="text" id="destino" class="form-control" placeholder="Ej: Cancún, Punta Cana, Brasil" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Teléfono</label>
          <input type="text" id="telefono" class="form-control" placeholder="Ej: 573016119737" />
        </div>

        <div class="col-md-2">
          <label class="form-label">Adultos</label>
          <input type="number" id="adultos" class="form-control" value="0" min="0" />
        </div>

        <div class="col-md-2">
          <label class="form-label">Niños</label>
          <input type="number" id="ninos" class="form-control" value="0" min="0" />
        </div>

        <div class="col-md-2">
          <label class="form-label">Infantes</label>
          <input type="number" id="infantes" class="form-control" value="0" min="0" />
        </div>

        <div class="col-md-6">
          <label class="form-label">Mes (opcional)</label>
          <select id="mes" class="form-select">
            <option value="">-- Cualquier mes --</option>
            <option value="ene">Enero</option>
            <option value="feb">Febrero</option>
            <option value="mar">Marzo</option>
            <option value="abr">Abril</option>
            <option value="may">Mayo</option>
            <option value="jun">Junio</option>
            <option value="jul">Julio</option>
            <option value="ago">Agosto</option>
            <option value="sep">Septiembre</option>
            <option value="oct">Octubre</option>
            <option value="nov">Noviembre</option>
            <option value="dic">Diciembre</option>
          </select>
        </div>

      </div>

      <button id="btnBuscar" class="btn btn-warning w-100 mt-3">
        <i class="bi bi-search"></i> Buscar
      </button>
    </div>

    <!-- RESULTADOS -->
    <div id="resultados" class="mt-4"></div>
  </div>

  <script>
    document.getElementById("btnBuscar").addEventListener("click", async () => {

      const destino = document.getElementById("destino").value.trim();
      const telefono = document.getElementById("telefono").value.trim();
      const adultos = Number(document.getElementById("adultos").value);
      const ninos = Number(document.getElementById("ninos").value);
      const infantes = Number(document.getElementById("infantes").value);
      const mes = document.getElementById("mes").value;
      const origen = document.getElementById("origen").value;
      const resultados = document.getElementById("resultados");
      resultados.innerHTML = `
        <div class="text-center mt-4">
          <div class="spinner-border text-warning"></div>
          <p class="mt-2">Buscando archivos...</p>
        </div>`;

      try {
        const res = await fetch("/api/buscar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },

          body: JSON.stringify({ destino, telefono, adultos, ninos, infantes, mes, origen })
        });

        const data = await res.json();

        // Si no hay resultados
        if (!Array.isArray(data) || data.length === 0) {
          resultados.innerHTML = `
            <div class="alert alert-danger text-center">
              <i class="bi bi-x-circle"></i> No se encontraron cotizaciones.
            </div>`;
          return;
        }

        let html = `<h3 class="mb-3"><i class="bi bi-list-check"></i> Resultados encontrados:</h3>`;
        html += `<div class="row g-3">`;
        data.forEach(pdf => {
          html += `
    <div class="col-md-6">
      <div class="card bg-secondary text-white p-3 shadow">
        <h5>
          <i class="bi bi-file-earmark-pdf"></i> ${pdf.archivo}
        </h5>

        <p class="mb-1"><strong>Destino:</strong> ${pdf.destino}</p>
        <p class="mb-1"><strong>Fechas:</strong> ${pdf.fechaIda ?? "N/A"} → ${pdf.fechaRegreso ?? "N/A"}</p>
        <p class="mb-1"><strong>Pasajeros:</strong> 
          ${pdf.adultosArchivo}A - ${pdf.ninosArchivo}K - ${pdf.infantesArchivo}I
        </p>
        <p class="mb-1"><strong>Teléfono:</strong> ${pdf.telefonoArchivo}</p>

        <p class="mb-1"><strong>Fecha Creación:</strong> ${pdf.createdTime}</p>

        <a href="${pdf.link}" target="_blank" class="btn btn-warning mt-2 w-100">
          <i class="bi bi-box-arrow-up-right"></i> Abrir PDF
        </a>
      </div>
    </div>
  `;
        });


        html += `</div>`;
        resultados.innerHTML = html;

      } catch (error) {
        resultados.innerHTML = `
          <div class="alert alert-danger">
            Error al consultar la API: ${error.message}
          </div>`;
      }
    });
  </script>

</body>

</html>